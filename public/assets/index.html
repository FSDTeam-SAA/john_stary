<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>MCYHM: Interactive Experience</title>
<script>
  if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
    document.write(`
      <style>
        html, body {
          margin: 0;
          padding: 0;
          width: 100vw;
          height: 100vh;
          background: #000;
          overflow: hidden;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        #mobile-holder img {
          width: 100%;
          height: 100%;
          object-fit: contain;
        }
      </style>
      <body>
        <div id="mobile-holder">
          <img src="images/MOBILE_MESSAGE_BLACK.png" alt="Mobile Notice">
        </div>
      </body>
    `);
    document.documentElement.innerHTML = document.body.innerHTML;
    throw new Error('Mobile redirect stop');
  }
</script>

<link href="images/favicon.ico" rel="icon"/>
<link href="https://cdn.plyr.io/3.7.8/plyr.css" rel="stylesheet"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;background:#000;font-family:Arial,sans-serif;}
:root{--plyr-color-main:#f5b301;}

/* Base layers */
#splash{position:fixed;inset:0;width:100%;height:100%;overflow:hidden;z-index:1;pointer-events:auto;}
#splash video.bgvid{position:absolute;width:100vw;height:100vh;object-fit:cover;z-index:0;}

.hotspot{
  position:absolute;
  background:transparent;
  cursor:pointer;
  transition:transform .25s,filter .25s;
  z-index:10040; /* above any decorative overlays */
  pointer-events:auto;
}
#cd:hover,#diary:hover,#bottles:hover{filter:brightness(1.2);transform:scale(1.05);}
.hotspot::after{
  content:attr(data-label);
  position:absolute;
  top:-28px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.75);
  color:#fff;
  font-size:14px;
  padding:3px 8px;
  border-radius:4px;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
  white-space:nowrap;
}
.hotspot:hover::after{opacity:1;}

/* Standard modals (Storywave, Bio, Recovery) */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  z-index:10060; /* above hotspots */
  justify-content:center;
  align-items:center;
  padding:20px;
  pointer-events:auto;
}

.modal-content{
  background:#111;
  color:#fff;
  border-radius:12px;
  box-shadow:0 0 25px rgba(0,0,0,.6);
  position:relative;
  width:min(90vw,1100px);
  max-height:90vh;
  overflow:hidden;
  padding:16px;
  text-align:center;
}

/* Storywave Flipbook */
#flipbook{position:relative;width:100%;aspect-ratio:16/9;background:#111;overflow:hidden;}
.flipbook-video {
  width:100%;
  height:100%;
  object-fit:contain;
  position:absolute;
  top:0;
  left:100%;
  opacity:0;
  transition:left .7s ease, opacity .7s ease;
}
.flipbook-video.active {
  left:0;
  opacity:1;
  z-index:2;
}
.flipbook-video.exit-left {
  left:-100%;
  opacity:0;
}

.nav-btn{
  position:absolute;top:60%;transform:translateY(-50%);
  border:none;cursor:pointer;background:rgba(0,0,0,.2);color:#ffae00;
  font-size:60px;padding:12px 22px;z-index:10020;border-radius:10px;
}

/* Decorative overlay */
.police-lights{position:fixed;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:0.3;z-index:5;}
.police-lights video{width:100%;height:100%;object-fit:cover;}

.big-modal-close{
  margin-top:12px;background:#ffae00;color:#000;padding:7px 22px;
  font-size:16px;border:none;border-radius:6px;cursor:pointer;
  box-shadow:0 1px 4px rgba(0,0,0,0.12);
}

/* Vimeo popups (Trailer/Reel) stay on top of everything else) */
.video-popup{
  display:none;
  position:fixed;inset:0;
  background:rgba(0,0,0,0.9);
  z-index:10070; /* on top of everything */
  justify-content:center;align-items:center;
  pointer-events:auto;
}

.video-popup iframe{
  width:85vw;max-width:1100px;aspect-ratio:16/9;
  border:none;border-radius:8px;box-shadow:0 0 25px rgba(0,0,0,0.6);
}
.video-popup button{
  position:absolute;top:4%;right:6%;
  background:#ffae00;color:#000;border:none;padding:8px 20px;
  border-radius:6px;font-weight:600;font-size:16px;cursor:pointer;
}
</style>
</head>
<body>
<div id="splash">
  <video autoplay class="bgvid" loop muted playsinline src="images/bgnew.webm"></video>
  <div class="hotspot" id="photo" data-label="TRAILER" style="top:4.3%;left:14%;width: 18%;height:20%;"></div>
  <div class="hotspot" id="console" data-label="STORYWAVE" style="top:38%;left:46%;width:25%;height:13%;"></div>
  <div class="hotspot" id="diary" data-label="BIO" style="top:57%;left:46%;width:22%;height:39%;"></div>
  <div class="hotspot" id="cd" data-label="REEL" style="bottom:1%;left:19%;width:18%;height:18%;border-radius:50%;"></div>
  <div class="hotspot" id="bottles" data-label="RECOVERY" style="bottom:7%;right:0%;width:25%;height:18%;"></div>
</div>

<!-- STORYWAVE (BOOK) -->
<div class="modal" id="book-modal">
  <div class="modal-content">
    <button aria-label="Close" class="modal-close big-modal-close" id="closeBook">CLOSE</button>
    <div id="flipbook">
  <video class="flipbook-video active" data-src="webm/00 Logline Slide.webm" playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page1.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/02 Slide 2(Fixed).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page3.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page4.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page5.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page6.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/07 Slide 3Tc (Fixed).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/08 Slide 3Ci( Fixed 2).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/09 Slide 3Ciii (Fixed).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/10 Slide 3Ciiii (Fixed 2).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/11 Slide 4A (Fixed).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page12.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page13.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page14.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page15.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page16.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page17.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page18.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page19.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page20.webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/21 Slide 7E (Fixed 3).webm" muted playsinline preload="auto"></video>
  <video class="flipbook-video" data-src="webm/page22.webm" muted playsinline preload="auto"></video>

  <!-- Static arrows so they always exist -->
  <button id="fb-prev" class="nav-btn" aria-label="Previous" style="left:30px;display:none;">‹</button>
  <button id="fb-next" class="nav-btn" aria-label="Next" style="right:30px;display:none;">›</button>
</div>

  </div>
</div>

<!-- TRAILER POPUP -->
<div id="trailer-popup" class="video-popup">
  <iframe id="trailer-video"
    src="https://player.vimeo.com/video/1128487959?h=b3ebb7a2b9&badge=0&autopause=0&player_id=0&app_id=58479"
    allow="autoplay; fullscreen" allowfullscreen></iframe>
  <button id="closeTrailer">CLOSE</button>
</div>

<!-- REEL POPUP -->
<div id="reel-popup" class="video-popup">
  <iframe id="reel-video"
    src="https://player.vimeo.com/video/1126380845?h=fcf2be0c83&byline=0&portrait=0&title=0&quality=4k"
    allow="autoplay; fullscreen" allowfullscreen></iframe>
  <button id="closeReel">CLOSE</button>
</div>

<!-- BIO -->
<div class="modal" id="bio-modal">
  <div class="modal-content">
    <img alt="BIO" src="images/BIO3.png" style="max-width:100%;max-height:80vh;"/>
    <button class="big-modal-close" id="closeBio">CLOSE</button>
  </div>
</div>

<!-- Decorative overlay -->
<div class="police-lights">
  <video autoplay loop muted playsinline>
    <source src="videos/police-lights.mp4" type="video/mp4"/>
  </video>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  /* ---------- Background music ---------- */
  const bgMusic = new Audio("audio/MCYHM_BG_MUSIC_GOOD.mp3");
  bgMusic.loop = true;
  let unlocked = false;
  function startMusic() {
    if (unlocked) return;
    unlocked = true;
    bgMusic.play().catch(()=>{});
  }
  document.addEventListener("click", startMusic, { once: true });
  document.addEventListener("keydown", startMusic, { once: true });

  const showFlex = el => el.style.display = "flex";
  const hideEl  = el => el.style.display = "none";

  /* ---------- Trailer popup ---------- */
  const trailerBtn   = document.getElementById("photo");
  const trailerPopup = document.getElementById("trailer-popup");
  const closeTrailer = document.getElementById("closeTrailer");
  const trailerFrame = document.getElementById("trailer-video");

  trailerBtn.onclick = () => { showFlex(trailerPopup); bgMusic.pause(); };
  closeTrailer.onclick = () => { hideEl(trailerPopup); if (unlocked) bgMusic.play().catch(()=>{}); };

  /* ---------- Reel popup ---------- */
  const reelBtn   = document.getElementById("cd");
  const reelPopup = document.getElementById("reel-popup");
  const closeReel = document.getElementById("closeReel");

  reelBtn.onclick = () => { showFlex(reelPopup); bgMusic.pause(); };
  closeReel.onclick = () => { hideEl(reelPopup); if (unlocked) bgMusic.play().catch(()=>{}); };

  /* ---------- Storywave simple flip ---------- */
  const bookModal   = document.getElementById("book-modal");
  const storyBtn    = document.getElementById("console");
  const closeBook   = document.getElementById("closeBook");
  const slides      = Array.from(document.querySelectorAll(".flipbook-video"));
  const prevBtn     = document.getElementById("fb-prev");
  const nextBtn     = document.getElementById("fb-next");
  let index = 0;

  // preload all videos once
  slides.forEach(v => { if (v.dataset.src) v.src = v.dataset.src; });

  function showSlideSimple(i) {
    slides.forEach((v, n) => {
      v.style.display = n === i ? "block" : "none";
      if (n === i) { v.currentTime = 0; v.play().catch(()=>{}); } else { v.pause(); }
    });
    prevBtn.style.display = i > 0 ? "block" : "none";
    nextBtn.textContent = i < slides.length - 1 ? "›" : "▶";
    nextBtn.style.fontSize = i < slides.length - 1 ? "60px" : "34px";
  }

  storyBtn.onclick = () => {
    showFlex(bookModal);
    bgMusic.pause();
    index = 0;
    showSlideSimple(index);
  };

  closeBook.onclick = () => { hideEl(bookModal); if (unlocked) bgMusic.play().catch(()=>{}); };

  prevBtn.onclick = () => {
    if (index > 0) index--;
    showSlideSimple(index);
  };

  nextBtn.onclick = () => {
    if (index < slides.length - 1) {
      index++;
      showSlideSimple(index);
    } else {
      hideEl(bookModal);
      showFlex(trailerPopup);
    }
  };

  /* ---------- Bio ---------- */
  const bioModal = document.getElementById("bio-modal");
  const bioBtn   = document.getElementById("diary");
  const closeBio = document.getElementById("closeBio");
  bioBtn.onclick = () => { showFlex(bioModal); bgMusic.pause(); };
  closeBio.onclick = () => { hideEl(bioModal); if (unlocked) bgMusic.play().catch(()=>{}); };

  /* ---------- Recovery ---------- */
  const recoveryBtn = document.getElementById("bottles");
  let recoveryModal = null;
  const preloadRecovery = new Image();
  preloadRecovery.src = "images/RECOVERY PAGE.png";

  function buildRecovery() {
    if (recoveryModal) return recoveryModal;
    recoveryModal = document.createElement("div");
    recoveryModal.className = "modal";
    recoveryModal.id = "recovery-modal";
    recoveryModal.innerHTML = `
      <div class="modal-content" style="text-align:center;">
        <img src="images/RECOVERY PAGE.png" style="max-width:100%;max-height:80vh;border-radius:8px;"/>
        <a href="https://triangle-club.com/recovery" target="_blank" rel="noopener"
           style="position:absolute;top:63%;left:35%;transform:translate(-50%,-50%);
           width:65%;height:30%;display:block;cursor:pointer;"></a>
        <button class="big-modal-close" id="closeRecovery">CLOSE</button>
      </div>`;
    document.body.appendChild(recoveryModal);
    recoveryModal.querySelector("#closeRecovery").onclick = () => {
      hideEl(recoveryModal);
      if (unlocked) bgMusic.play().catch(()=>{});
    };
    return recoveryModal;
  }

  recoveryBtn.onclick = () => { showFlex(buildRecovery()); bgMusic.pause(); };
});
</script>
</body>
</html>
